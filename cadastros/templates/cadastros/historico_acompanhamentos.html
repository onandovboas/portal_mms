<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Histórico Pedagógico de {{ aluno.nome_completo }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container my-4">

    <header class="d-flex align-items-center justify-content-between mb-4 flex-wrap gap-2">
      <div>
        <h1 class="h3 mb-1">Histórico Pedagógico</h1>
        <p class="text-muted mb-0">Aluno: <strong>{{ aluno.nome_completo }}</strong></p>
      </div>
      <div class="d-flex gap-2">
        <a href="{% url 'cadastros:liberar_prova' aluno.pk %}" class="btn btn-primary">
          <i class="bi bi-send me-1"></i> Liberar Nova Prova
        </a>
        <a href="{% url 'cadastros:lista_acompanhamento_pedagogico' %}" class="btn btn-outline-secondary">
          &larr; Voltar aos Acompanhamentos
        </a>
      </div>
    </header>

    <section class="card mb-4">
      <div class="card-header"><h2 class="h5 mb-0">Avaliações e Provas</h2></div>
      <div class="list-group list-group-flush">
        {% for prova in provas %}
          <a 
            {% if prova.status == 'finalizada' %}
              href="{% url 'cadastros:ver_resultado_prova' prova.pk %}"
            {% elif prova.status == 'aguardando_correcao' %}
              href="{% url 'cadastros:corrigir_prova' prova.pk %}"
            {% else %}
              href="#" class="disabled"
            {% endif %}
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          >
            <div>
              <h6 class="mb-1">{{ prova.prova_template.titulo }}</h6>
              <small class="text-muted">Liberada em: {{ prova.data_realizacao|date:"d/m/Y" }}</small>
            </div>
            <span class="badge 
              {% if prova.status == 'nao_iniciada' %}text-bg-secondary
              {% elif prova.status == 'em_progresso' %}text-bg-info
              {% elif prova.status == 'aguardando_correcao' %}text-bg-warning
              {% elif prova.status == 'finalizada' %}text-bg-success
              {% endif %}">
              {{ prova.get_status_display }}
            </span>
          </a>
          {% empty %}
          <div class="card-body text-center text-muted">Nenhuma prova liberada para este aluno.</div>
        {% endfor %}
      </div>
    </section>

    <section class="card">
      <div class="card-header"><h2 class="h5 mb-0">Acompanhamentos Individuais</h2></div>
      <div class="accordion" id="accordionAcompanhamentos">
        {% for acomp in acompanhamentos %}
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading-{{ acomp.pk }}">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ acomp.pk }}" aria-expanded="false" aria-controls="collapse-{{ acomp.pk }}">
                <strong>
                  {% if acomp.status == 'realizado' %}
                    Realizado em: {{ acomp.data_realizacao|date:"d/m/Y" }}
                  {% else %}
                    Agendado para: {{ acomp.data_agendamento|date:"d/m/Y" }} ({{ acomp.get_status_display }})
                  {% endif %}
                </strong>
              </button>
            </h2>
            <div id="collapse-{{ acomp.pk }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ acomp.pk }}" data-bs-parent="#accordionAcompanhamentos">
              <div class="card-body">
                <dl class="row">
                  <dt class="col-sm-3">Status</dt>
                  <dd class="col-sm-9">{{ acomp.get_status_display }}</dd>

                  <dt class="col-sm-3">Stage no momento</dt>
                  <dd class="col-sm-9">{{ acomp.stage_no_momento }}</dd>
                  
                  <dt class="col-sm-3">Dificuldades</dt>
                  <dd class="col-sm-9">{{ acomp.dificuldades|linebreaksbr|default:"-" }}</dd>

                  <dt class="col-sm-3">Pontos Fortes</dt>
                  <dd class="col-sm-9">{{ acomp.pontos_fortes|linebreaksbr|default:"-" }}</dd>
                  
                  <dt class="col-sm-3">Pontos a Melhorar</dt>
                  <dd class="col-sm-9">{{ acomp.pontos_melhorar|linebreaksbr|default:"-" }}</dd>

                  <dt class="col-sm-3">Estratégia</dt>
                  <dd class="col-sm-9">{{ acomp.estrategia|linebreaksbr|default:"-" }}</dd>
                  
                  <dt class="col-sm-3">Atividades e Recomendações</dt>
                  <dd class="col-sm-9">{{ acomp.atividades_recomendadas|linebreaksbr|default:"-" }}</dd>
                </dl>
                <hr>
                <div class="text-end">
                  <a href="{% url 'cadastros:editar_acompanhamento' acomp.pk %}" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-pencil me-1"></i> Editar
                  </a>
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="card-body text-center text-muted">Nenhum acompanhamento individual registado.</div>
        {% endfor %}
      </div>
    </section>

  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>