<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Histórico Pedagógico de {{ aluno.nome_completo }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container my-4">

    <header class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <h1 class="h3 mb-1">Histórico Pedagógico</h1>
        <p class="text-muted mb-0">Aluno: <strong>{{ aluno.nome_completo }}</strong></p>
      </div>
      <a href="{% url 'cadastros:perfil_aluno' aluno.pk %}" class="btn btn-outline-secondary">
        &larr; Voltar ao Perfil do Aluno
      </a>
    </header>

    <div class="accordion" id="accordionAcompanhamentos">
      {% for acomp in acompanhamentos %}
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-{{ acomp.pk }}">
            <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ acomp.pk }}" aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="collapse-{{ acomp.pk }}">
              <div class="d-flex justify-content-between w-100 me-3">
                <span>
                  <i class="bi bi-calendar-event me-2"></i>
                  Acompanhamento de <strong>{{ acomp.data_agendamento|date:"d/m/Y" }}</strong>
                </span>
                <span class="badge 
                  {% if acomp.status == 'realizado' %}text-bg-success
                  {% elif acomp.status == 'agendado' %}text-bg-warning
                  {% else %}text-bg-secondary{% endif %}">
                  {{ acomp.get_status_display }}
                </span>
              </div>
            </button>
          </h2>
          <div id="collapse-{{ acomp.pk }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" aria-labelledby="heading-{{ acomp.pk }}" data-bs-parent="#accordionAcompanhamentos">
            <div class="accordion-body">
              <div class="d-flex justify-content-end mb-3">
                <a href="{% url 'cadastros:editar_acompanhamento' acomp.pk %}" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-pencil-square me-1"></i> Editar este Registo
                </a>
              </div>

              <dl class="row">
                <dt class="col-sm-3">Data Agendada:</dt>
                <dd class="col-sm-9">{{ acomp.data_agendamento|date:"d/m/Y, H:i" }}</dd>

                <dt class="col-sm-3">Data de Realização:</dt>
                <dd class="col-sm-9">{{ acomp.data_realizacao|date:"d/m/Y, H:i"|default:"<span class='text-muted'>Não realizado</span>" }}</dd>
                
                <dt class="col-sm-3">Stage no Momento:</dt>
                <dd class="col-sm-9">{{ acomp.stage_no_momento }}</dd>

                <dt class="col-sm-3">Registado por:</dt>
                <dd class="col-sm-9">{{ acomp.criado_por.nome_completo|default:"-" }}</dd>
              </dl>
              <hr>
              
              <h5 class="mt-4">Detalhes da Entrevista</h5>
              
              <h6>Dificuldades</h6>
              <p class="text-muted border-start border-3 ps-3">{{ acomp.dificuldades|linebreaksbr|default:"Nenhum registo." }}</p>

              <h6>Relação com a língua</h6>
              <p class="text-muted border-start border-3 ps-3">{{ acomp.relacao_lingua|linebreaksbr|default:"Nenhum registo." }}</p>
              
              <h6>Objetivo do estudo</h6>
              <p class="text-muted border-start border-3 ps-3">{{ acomp.objetivo_estudo|linebreaksbr|default:"Nenhum registo." }}</p>
              
              <h6>Correção de ditados</h6>
              <p class="text-muted border-start border-3 ps-3">{{ acomp.correcao_ditados|linebreaksbr|default:"Nenhum registo." }}</p>
              
              <h6>Pontos fortes</h6>
              <p class="text-muted border-start border-3 ps-3">{{ acomp.pontos_fortes|linebreaksbr|default:"Nenhum registo." }}</p>
              
              <h6>Pontos a serem melhorados</h6>
              <p class="text-muted border-start border-3 ps-3">{{ acomp.pontos_melhorar|linebreaksbr|default:"Nenhum registo." }}</p>
              
              <h6>Estratégia</h6>
              <p class="text-muted border-start border-3 ps-3">{{ acomp.estrategia|linebreaksbr|default:"Nenhum registo." }}</p>
              
              <h6>Comentários extras</h6>
              <p class="text-muted border-start border-3 ps-3">{{ acomp.comentarios_extras|linebreaksbr|default:"Nenhum registo." }}</p>

            </div>
          </div>
        </div>
      {% empty %}
        <div class="card">
          <div class="card-body text-center text-muted">
            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
            Nenhum acompanhamento pedagógico registado para este aluno.
          </div>
        </div>
      {% endfor %}
    </div>

  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>